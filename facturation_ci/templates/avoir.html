<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <title>Facture d'Avoir #{{ invoice.code_avoir }}</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563EB; /* Blue shade for credit notes */
            --primary-dark: #1D4ED8;
            --white: #FFFFFF;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-800: #1F2937;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; line-height: 1.6; color: var(--gray-700); padding: 40px; }
        h1 { font-size: 24px; font-weight: 600; color: var(--primary); margin-bottom: 10px; border-bottom: 2px solid var(--primary); padding-bottom: 6px; }
        h3 { font-size: 12px; text-transform: uppercase; color: var(--gray-600); margin-bottom: 8px; }
        .details-container { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin: 20px 0 30px; }
        .detail-box { font-size: 13px; }
        .company-name, .client-name { font-weight: 600; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0 30px; font-size: 13px; }
        th { background-color: var(--gray-100); padding: 10px 12px; text-align: left; font-weight: 600; text-transform: uppercase; font-size: 12px; border-bottom: 2px solid var(--gray-300); }
        td { padding: 10px 12px; border-bottom: 1px solid var(--gray-200); }
        .text-right { text-align: right; }
        .totals-container { display: flex; justify-content: flex-end; }
        .totals { width: 300px; padding: 16px; border: 1px solid var(--gray-200); border-radius: 6px; }
        .total-row { display: flex; justify-content: space-between; padding: 6px 0; }
        .grand-total { border-top: 1px solid var(--gray-300); margin-top: 10px; padding-top: 10px; font-size: 16px; font-weight: 600; color: var(--primary-dark); }
        .notes { margin-top: 30px; padding: 16px; background-color: #FAFAFA; border-radius: 4px; text-align: center; }
        .fne-panel { border: 1px solid var(--primary); border-radius: 8px; padding: 10px; text-align: center; background-color: #EFF6FF; }
        .fne-panel h3 { font-size: 11px; color: var(--primary-dark); margin-bottom: 5px; }
        .fne-logo { max-width: 60px; margin-bottom: 5px; }
        .fne-qr-code { max-width: 80px; }
    </style>
</head>
<body>
    <div>
        <h1>Facture d'Avoir</h1>

        <div class="details-container">
            <div class="detail-box">
                <h3>Émetteur</h3>
                <div class="company-name">{{ company.name }}</div>
                <div>{{ company.address | replace('\n', '<br>') | safe }}</div>
                <div>{{ company.contact }}</div>
            </div>
            <div class="detail-box">
                <h3>Client</h3>
                <div class="client-name">{{ client.name }}</div>
                <div>{{ client.address | replace('\n', '<br>') | safe }}</div>
                <div>{{ client.contact }}</div>
            </div>
            <div class="detail-box">
                <h3>Informations</h3>
                <div><strong>#{{ invoice.code_avoir }}</strong></div>
                <div>Date: {{ invoice.date_creation.strftime('%d-%m-%Y') }}</div>
                <div>Facture d'origine: {{ invoice.code_facture_origine }}</div>
                {% if qr_code_uri %}
                <div class="fne-panel" style="margin-top:10px;">
                    <h3>Avoir Nº {{ invoice.fne_nim }}</h3>
                    <img src="{{ fne_logo_uri }}" alt="Logo FNE" class="fne-logo">
                    <img src="{{ qr_code_uri }}" alt="QR Code FNE" class="fne-qr-code">
                </div>
                {% endif %}
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Description</th>
                    <th class="text-right">Quantité</th>
                    <th class="text-right">Prix Unitaire</th>
                    <th class="text-right">Total HT</th>
                </tr>
            </thead>
            <tbody>
                {% for item in details %}
                <tr>
                    <td>{{ item.description }}</td>
                    <td class="text-right">{{ item.quantity }}</td>
                    <td class="text-right">{{ money(item.unit_price) }}</td>
                    <td class="text-right">{{ money(item.quantity * item.unit_price) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="totals-container">
            <div class="totals">
                <div class="total-row">
                    <span>Sous-total HT</span>
                    <span>{{ money(subtotal) }}</span>
                </div>
                {% for rate, amount in taxes.items() %}
                <div class="total-row">
                    <span>TVA ({{ rate }}%)</span>
                    <span>{{ money(amount) }}</span>
                </div>
                {% endfor %}
                <div class="total-row grand-total">
                    <span>Total TTC</span>
                    <span>{{ money(grand_total) }}</span>
                </div>
            </div>
        </div>

        <div class="notes">
            <em>Total en lettres : {{ grand_total_words }}</em>
        </div>
    </div>
</body>
</html>
